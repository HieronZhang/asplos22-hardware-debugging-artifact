# Debugging in the Brave New World of Reconfigurable Hardware  (Artifact)

This artifact includes 13 hardware bugs, each of them can be reproduced with Verilator in a push-button manner. It also includes the five tools we designed to help bug localization (i.e., SignalCat, FSM Monitor, Statistics Monitor, Dependency Monitor, and LossCheck), as well as examples of using these tools and the instructions of reproducing the figures in the paper.

## Table of Contents

- [0. Downloading the Repository](#downloading-the-repository)

- [1. Reproducible Bugs](#1-reproducible-bugs)
  - [1.1 Installation](#1-1-installation)
  - [1.2 Reproducing Bugs with Verilator](#1-2-table-of-bugs)
- [2. Debugging Tools](#2-debugging-tools)
  - [2.1 Installation](#2-1-installation)
  - [2.2 SignalCat and the Monitors](#2-2-signalcat-and-monitors)
    - [2.2.1 Debugging Logs with SignalCat and the Monitors](#2-2-1-debugging-logs-with-signalcat-and-the-monitors)
    - [2.2.2 Reproducing the Resource Overhead (Intel FPGA)](#2-2-2-reproducing-the-resource-overhead-intel-fpga)
    - [2.2.3 Reproducing the Resource Overhead (Xilinx FPGA)](#2-2-3-reproducing-the-resource-overhead-xilinx-fpga)
  - [2.3 LossCheck](#2-3-losscheck)
    - [2.3.1 Data Loss Localization for the 4 Data Loss Bugs](#2-3-1-data-loss-localization-for-the-4-data-loss-bugs)
    - [2.3.2 Reproducing the Resource Overhead](#2-3-2-reproducing-the-resource-overhead)
- [3. Licenses and Terms](#3-licenses-and-terms)

## 0. Downloading the Repository

Use the following command to download the artifact repository:

```bash
git clone https://github.com/efeslab/asplos22-hardware-debugging-artifact --recursive
```

After this command, you are expected to see the following directory hierarchy:

```bash
asplos22-hardware-debugging-artifact
├── hardware-bugbase
│   ├── c1-dead-lock-sdspi
│   ├── c2-producer-consumer-mismatch-optimus
│   ├── c3-data-control-asynchrony-sdspi
│   ├── common
│   ├── d1-buffer-overflow-rsd
│   ├── d2-buffer-overflow-grayscale
│   ├── d3-buffer-overflow-optimus
│   ├── d4-bit-truncation-sha512
│   ├── d5-bit-truncation-fft
│   ├── d6-misindexing-fadd
│   ├── d7-endianness-mismatch-sdspi
│   ├── d8-failure-to-reset-sha512
│   ├── manual_debug_log
│   ├── s1-protocol-violation-axi-lite
│   ├── s2-protocol-violation-axi-stream
│   ├── scripts
│   └── venv
└── veripass
    ├── dbgtools
    ├── model
    ├── passes
    ├── __pycache__
    ├── Pyverilog
    ├── recording
    ├── utils
    └── verilator
```

## 1. Reproducible Bugs

The `hardware-bugbase` directory contains all the reproducible bugs. Each bug is located in a directory, together with a simplified code snippet that helps understanding.

### 1.1 Installation

You will need to install compile `Verilator` to reproduce these bugs. `Verilator` is located under the `veripass` directory.

Before compilation, you will need to install a few dependencies:

```bash
sudo apt-get install perl python3 make autoconf g++ flex bison ccache
sudo apt-get install libgoogle-perftools-dev numactl perl-doc
sudo apt-get install libfl2 libfl-dev  # Ubuntu only (ignore if gives error)
sudo apt-get install zlibc zlib1g zlib1g-dev  # Ubuntu only (ignore if gives error)
```

Then compile `Verilator`:

```bash
cd asplos22-hardware-debugging-artifact/veripass/verilator
autoconf
./configure
make -j8
```

Compilation is enough. You do not need to install it. Scripts in the bug database will find the location of `Verilator` themselves.

### 1.2 Reproducing Bugs with Verilator

Bugs are listed in the table below. You may `cd` into the directory of each bug to reproduce it and read its documentations.

To reproduce a specific bug:

```bash
cd asplos22-hardware-debugging-artifact/hardware-bugbase/<bug-dir>
make -j8
make sim  # run the simulation
make wave # open the generated waveform with GTKWave
```

You are expected to see an error message after `make sim`. `make wave` requires you using GUI, or the `DISPLAY` environment variable being set correctly. After simulation, you can also find a `.fst` file or a `.vcd` file under the directory. These are the waveforms generated by `Verilator`. You can copy the file to another computer and open it with `GTKWave` or other waveform-viewing software.

| Bug ID | Bug Name                                                     |
| ------ | ------------------------------------------------------------ |
| D1     | [Buffer Overflow - RSD](https://github.com/efeslab/hardware-bugbase/tree/bugs/d1-buffer-overflow-rsd) |
| D2     | [Buffer Overflow - Grayscale](https://github.com/efeslab/hardware-bugbase/tree/bugs/d2-buffer-overflow-grayscale) |
| D3     | [Buffer Overflow - Optimus](https://github.com/efeslab/hardware-bugbase/tree/bugs/d3-buffer-overflow-optimus) |
| D4     | [Bit Truncation - SHA512](https://github.com/efeslab/hardware-bugbase/tree/bugs/d4-bit-truncation-sha512) |
| D5     | [Bit Truncation - FFT](https://github.com/efeslab/hardware-bugbase/tree/bugs/d5-bit-truncation-fft) |
| D6     | [Misindexing - FADD](https://github.com/efeslab/hardware-bugbase/tree/bugs/d6-misindexing-fadd) |
| D7     | [Endianness Mismatch - SDSPI](https://github.com/efeslab/hardware-bugbase/tree/bugs/d7-endianness-mismatch-sdspi) |
| D8     | [Failure-to-Reset - SHA512](https://github.com/efeslab/hardware-bugbase/tree/bugs/d8-failure-to-reset-sha512) |
| C1     | [Dead Lock - SDSPI](https://github.com/efeslab/hardware-bugbase/tree/bugs/c1-dead-lock-sdspi) |
| C2     | [Producer-Consumer Mismatch - Optimus](https://github.com/efeslab/hardware-bugbase/tree/bugs/c2-producer-consumer-mismatch-optimus) |
| C3     | [Data-Control Asynchrony - SDSPI](https://github.com/efeslab/hardware-bugbase/tree/bugs/c3-data-control-asynchrony-sdspi) |
| S1     | [Protocol Violation - AXI-Lite](https://github.com/efeslab/hardware-bugbase/tree/bugs/s1-protocol-violation-axi-lite) |
| S1     | [Protocol Violation - AXI-Stream](https://github.com/efeslab/hardware-bugbase/tree/bugs/s2-protocol-violation-axi-stream) |

## 2. Debugging Tools

### 2.1 Installation

To run the debugging tools, you will need to compile `Verilator` and `Pyverilog` if you have not done so already:

```bash
cd asplos22-hardware-debugging-artifact/veripass
make -j8
```

And install the following python packages:

```bash
pip3 install jinja2 sympy ply gephistreamer
```

And add the following lines to your `.bashrc` or `.zshrc` to help the scripts find `Vivado`, `Quartus`, and `VCS`. `Vivado` must be the `System Design` edition, `Quartus` must be the `Pro` edition with version `17.0`, and `VCS` must be the `MX` edition.

```bash
# Quartus Pro
export QUARTUS_HOME=<your-quartus-home>/17.0/quartus
export PATH=$QUARTUS_HOME/bin:$PATH
export LM_LICENSE_FILE=<your-quartus-license>

# Vivado
export XILINX_VIVADO=<your-vivado-home>/Vivado/2020.2
export PATH=$XILINX_VIVADO/bin:$PATH
export XILINXD_LICENSE_FILE=<your-vivado-license>

# VCS MX
export VCS_HOME=<your-vcs-home>
export PATH=$VCS_HOME/bin:$PATH
export SNPSLMD_LICENSE_FILE=<your-vcs-license>
```

In order to synthesize projects for Intel HARP, you will need to download a supported version of Intel FPGA Basic Building Blocks, a set of platform files for HARP, and have the following additional lines in `.bashrc` or `.zshrc`. You can obtain our supported `intel-fpga-bbb` [here](https://github.com/efeslab/optimus-intel-fpga-bbb), and ask your Intel contact to obtain `BBS_6.4.0`. You may want to read [this](https://www.intel.com/content/dam/www/programmable/us/en/pdfs/literature/manual/mnl-ias-ccip.pdf) to understand the interface of the HARP platform.

```bash
export FPGA_BBB_CCI_SRC=<your-bbb-location>/optimus-intel-fpga-bbb
export OPAE_PLATFORM_ROOT=<your-opae-platform-root>/BBS_6.4.0
export PATH=$OPAE_PLATFORM_ROOT/bin:$PATH
```

### 2.2 SignalCat and the Monitors

#### 2.2.1 Debugging Logs with SignalCat and the Monitors



#### 2.2.2 Reproducing the Resource Overhead (Intel FPGA)

#### 2.2.3 Reproducing the Resource Overhead (Xilinx FPGA)

### 2.3 LossCheck

#### 2.3.1 Data Loss Localization for the 4 Data Loss Bugs



#### 2.3.2 Reproducing the Resource Overhead

## 3. Licenses and Terms

This artifact includes modified versions of Pyverilog (`veripass/Pyverilog`) and Verilator (`veripass/verilator`), which are released under their original licenses. Bugs in the `hardware-bugbase` directory are collected (and organized) from different sources, and are also released under the original licenses of the original implementation.

Our debugging tools under the `veripass` directory are released under the `GPLv3` license, whatever it means. Please also note that these tools are academic prototypes and may not be stable, reliable, or always correct; use it at your own risk.

By downloading/cloning/forking the `veripass` repository, you have known and agreed to all terms included in `GPLv3`, and that the developers/authors of these tools will not be responsible for any of your losses and/or damages, including but not limited to the tools not working as expected, unexpected kernel panic, damage of software/hardware, unrecoverable data loss, your loved ones being unhappy of you working/hacking at 3am, and CK-class end-of-the-world scenarios that the SCP foundation cannot stop.

If you find our work interesting, please cite our paper.

```
@inproceedings{ma2022debugging,
  title={Debugging in the Brave New World of Reconfigurable Hardware},
  author={Ma, Jiacheng and Zuo, Gefei and Loughlin, Kevin and Zhang, Haoyang and Quinn, Andrew and Kasikci, Baris},
  booktitle={Proceedings of the Twenty-Seventh International Conference on Architectural Support for Programming Languages and Operating Systems},
  year={2022}
}
```

